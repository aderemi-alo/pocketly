name: Branch/PR Naming Validation

on:
  pull_request:
    branches: [dev]
  push:
    branches: [dev]

jobs:
  validate-naming:
    name: Validate Branch/PR Naming
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Validate branch naming
        run: |
          # Get the branch name
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            BRANCH_NAME="${{ github.head_ref }}"
          else
            BRANCH_NAME="${{ github.ref_name }}"
          fi
          
          echo "Validating branch: $BRANCH_NAME"
          
          # Check if branch name follows the required pattern
          if [[ ! "$BRANCH_NAME" =~ ^(feat|fix|chore|refactor)[:/].* ]]; then
            echo "❌ Branch name '$BRANCH_NAME' does not follow the required pattern."
            echo "Branch names must start with one of: feat:, fix:, chore:, or refactor:"
            echo "The colon can be replaced with a slash (/) as well."
            echo "Examples: feat:add-user-auth, fix/bug-in-login, chore:update-deps, refactor:cleanup-code"
            exit 1
          fi
          
          echo "✅ Branch name '$BRANCH_NAME' follows the required pattern."
          
      - name: Validate PR title (if PR)
        if: github.event_name == 'pull_request'
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          echo "Validating PR title: $PR_TITLE"
          
          # Check if PR title follows the required pattern
          if [[ ! "$PR_TITLE" =~ ^(feat|fix|chore|refactor)[:/].* ]]; then
            echo "❌ PR title '$PR_TITLE' does not follow the required pattern."
            echo "PR titles must start with one of: feat:, fix:, chore:, or refactor:"
            echo "The colon can be replaced with a slash (/) as well."
            echo "Examples: feat: Add user authentication, fix/Bug in login flow, chore: Update dependencies"
            exit 1
          fi
          
          echo "✅ PR title '$PR_TITLE' follows the required pattern."
